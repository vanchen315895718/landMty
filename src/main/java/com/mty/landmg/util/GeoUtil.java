package com.mty.landmg.util;

import org.geotools.geojson.geom.GeometryJSON;
import org.geotools.geometry.jts.JTSFactoryFinder;
import org.locationtech.jts.geom.Geometry;
import org.locationtech.jts.geom.GeometryFactory;
import org.locationtech.jts.io.ParseException;
import org.locationtech.jts.io.WKTReader;
import org.locationtech.jts.io.WKTWriter;

import java.io.IOException;

/**
 * geo工具类
 *
 * @author york
 * @since 2025-02-25
 * @description wkt & geojson互转
 */
public class GeoUtil {

    public static String convertWKTToGeoJSON(String wkt) throws ParseException {
        GeometryFactory geometryFactory = JTSFactoryFinder.getGeometryFactory(null);
        WKTReader reader = new WKTReader(geometryFactory);
        GeometryJSON geometryJSON = new GeometryJSON();

        try {
            Geometry geometry = reader.read(wkt);
            return geometryJSON.toString(geometry);
        } catch (Exception e) {
            e.printStackTrace();
            throw e;
        }
    }

    public static String convertGeoJSONToWKT(String geojson) throws IOException {
        GeometryJSON geometryJSON = new GeometryJSON();
        GeometryFactory geometryFactory = JTSFactoryFinder.getGeometryFactory(null);
        WKTWriter writer = new WKTWriter();

        try {
            Geometry geometry = geometryJSON.read(geojson);
            return writer.write(geometry);
        } catch (IOException e) {
            e.printStackTrace();
            throw e;
        }
    }

/*    public static void main(String[] args) throws ParseException, IOException {
        System.out.println(GeoUtil.convertWKTToGeoJSON("MULTIPOLYGON(((121.094480074459 30.9951360160875,121.094471554135 30.9951302460925,121.0944633619 30.9951257061736,121.094452206857 30.9951215215594,121.094443063362 30.9951215944143,121.094210608906 30.9951234198555,121.094158299619 30.995125180571,121.094096855834 30.9951263011391,121.094034981928 30.9951287316022,121.094007048295 30.995130245038,121.093965249871 30.9951280762174,121.093926146182 30.9951292670266,121.093887537627 30.9951339519487,121.093855192783 30.9951411523407,121.09383349785 30.9951486572355,121.093791798445 30.9951646904208,121.093786990129 30.9951825862789,121.093779336033 30.9952141064591,121.093785504717 30.9952441038907,121.093791026224 30.9952927741582,121.093788995662 30.9953748406288,121.093791838427 30.9955257242016,121.093801555067 30.9957459243465,121.093811234708 30.9958275345705,121.09382248378 30.9958732751863,121.093834367027 30.9959023069618,121.09385087554 30.9959171018336,121.093868998495 30.9959249670891,121.09389004925 30.9959307110339,121.093913906773 30.9959327506404,121.093940312991 30.9959326148469,121.093969515974 30.995930956711,121.094029071251 30.9959263367081,121.094192877003 30.9959143941913,121.094318182218 30.9959118336102,121.094413403209 30.9959090159578,121.094455680746 30.9959075098777,121.094486198073 30.9958944980447,121.094497649198 30.9958876527351,121.094507999023 30.9958594361806,121.09451391464 30.9958180265944,121.094516676395 30.9957965562558,121.094512084145 30.995766012198,121.094512150165 30.9957401852299,121.09451172005 30.9957097781482,121.094511937112 30.9956712212236,121.094512802351 30.995624671456,121.094513820633 30.9955744597265,121.094508675233 30.9955198575542,121.094506326595 30.9954879480235,121.094501484276 30.9954617039043,121.094501195199 30.9954301568564,121.094485187853 30.9951496542784,121.094480074459 30.9951360160875)))"));
        System.out.println(GeoUtil.convertGeoJSONToWKT("{\"type\":\"MultiPolygon\",\"coordinates\":[[[[121.0945,30.9951],[121.0945,30.9951],[121.0945,30.9951],[121.0945,30.9951],[121.0944,30.9951],[121.0942,30.9951],[121.0942,30.9951],[121.0941,30.9951],[121.094,30.9951],[121.094,30.9951],[121.094,30.9951],[121.0939,30.9951],[121.0939,30.9951],[121.0939,30.9951],[121.0938,30.9951],[121.0938,30.9952],[121.0938,30.9952],[121.0938,30.9952],[121.0938,30.9952],[121.0938,30.9953],[121.0938,30.9954],[121.0938,30.9955],[121.0938,30.9957],[121.0938,30.9958],[121.0938,30.9959],[121.0938,30.9959],[121.0939,30.9959],[121.0939,30.9959],[121.0939,30.9959],[121.0939,30.9959],[121.0939,30.9959],[121.094,30.9959],[121.094,30.9959],[121.0942,30.9959],[121.0943,30.9959],[121.0944,30.9959],[121.0945,30.9959],[121.0945,30.9959],[121.0945,30.9959],[121.0945,30.9959],[121.0945,30.9958],[121.0945,30.9958],[121.0945,30.9958],[121.0945,30.9957],[121.0945,30.9957],[121.0945,30.9957],[121.0945,30.9956],[121.0945,30.9956],[121.0945,30.9955],[121.0945,30.9955],[121.0945,30.9955],[121.0945,30.9954],[121.0945,30.9951],[121.0945,30.9951]]]]}"));
    }*/
}
